<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8"/>
    <title>Festa da Maitê</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --rosa: #d63384;
            --rosa-escuro: #ad2a6b;
            --verde: #28a745;
            --cinza-borda: #dcdcdc;
            --bg-grad: linear-gradient(135deg, #ffe0f0, #ffc4e1);
            --card-bg: #fff;
            --radius-card: 18px;
            --radius-btn: 8px;
            --poppins: 'Poppins', sans-serif;
        }
        body {
            margin: 0;
            font-family: var(--poppins);
            background: var(--bg-grad);
            min-height: 100vh;
            color: #333;
        }
        .center-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 16px;
            text-align: center;
        }
        .card {
            background: var(--card-bg);
            padding: 32px 28px;
            border-radius: var(--radius-card);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 16px;
            text-align: left;
        }
        h1, h2, h3 {
            margin-top: 0;
            font-weight: 600;
        }
        h1 { color: var(--rosa); font-size: 1.9rem; text-align: center; }
        h2 { color: var(--rosa); font-size: 1.4rem; text-align: center; }
        h3 { color: var(--rosa); font-size: 1.1rem; margin-bottom: 8px; }
        p { line-height: 1.4; margin: 0 0 1em; }
        .btn {
            background-color: var(--rosa);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius-btn);
            font-size: 16px;
            cursor: pointer;
            margin-top: 16px;
            width: 100%;
        }
        .btn:hover { background-color: var(--rosa-escuro); }
        .form-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--cinza-borda);
            border-radius: var(--radius-btn);
            box-sizing: border-box;
        }
        #sugestaoPresente {
            width: 100%;
            min-height: 120px;
            padding: 0.75rem;
            border: 1px solid var(--cinza-borda);
            border-radius: var(--radius-btn);
            box-sizing: border-box;
            background: #f8f9fa;
            line-height: 1.4;
            text-align: left;
            cursor: text;
        }
        .text-center {
            text-align: center;
        }
        @media (max-width:480px) {
            .card { padding: 24px 20px; }
            h1 { font-size: 1.6rem; }
            .btn { width: 100%; }
        }
    </style>
</head>
<body>

<div class="center-wrap">
    <div class="card">
        <h1>Aniversário da Maitê!</h1>
        <p>Olá, <strong id="responsavelNome"></strong>!</p>
        <p>A Maitê está muito feliz em te convidar para a festa de aniversário dela! Por favor, confirme a presença dos seguintes membros:</p>
        <ul id="listaMembros"></ul>
        <div class="form-group">
            <label for="confirmacaoSelect">Confirmar Presença:</label>
            <select id="confirmacaoSelect" class="form-control">
                <option value="sim">Sim, vamos!</option>
                <option value="nao">Não poderemos ir</option>
            </select>
        </div>
        <div id="campoAusencia" class="form-group" style="display:none;">
            <label for="motivoAusencia">Qual o motivo da ausência (opcional)?</label>
            <input type="text" id="motivoAusencia" placeholder="Ex: Viagem, outro compromisso">
        </div>
        <button id="enviarConfirmacao" class="btn" type="button">Enviar Confirmação</button>
        <div id="mensagemAgradecimento" style="display:none; margin-top: 20px;">
            <h2>Obrigado por sua confirmação!</h2>
            <p>Sua resposta é muito importante para a organização da festa da Maitê.</p>
            <h3>Sugestão de Presente para a Maitê:</h3>
            <div id="sugestaoPresente"></div>
        </div>
        <p style="text-align:center; margin-top: 20px; font-size: 0.8em; color: #888;">Em caso de dúvidas, entre em contato com a Família da Maitê.</p>
    </div>
</div>

<script>
    const STORAGE_KEY = 'conviteMaite_familias_v1'; // Chave para o localStorage
    const SUGESTAO_KEY = 'conviteMaite_sugestao_v1';
    let sugestaoPresente = `
        *Sugestão de Presente*
        <br><br>
        Roupa tamanho 1
        <br>
        Sapato nº 17/18
        <br>
        Gosta de brinquedos coloridos
        <br><br>
        _(Essas são apenas sugestões! Sua presença é o melhor presente.)_
    `.trim().replace(/\n/g, '');

    document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const responsavel = params.get('familia');
        const membrosRaw = params.get('membros');

        // --- INÍCIO DA NOVA VERIFICAÇÃO DE LINK EXPIRADO ---
        if (responsavel && membrosRaw) {
            try {
                const familias = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                const fam = familias.find(f => 
                    decodeURIComponent(f.responsavel) === responsavel && 
                    decodeURIComponent(f.membros) === membrosRaw
                );

                if (fam && fam.linkDesativado) {
                    // Redireciona para a página de link expirado
                    window.location.replace('link_expirado.html');
                    return; // Interrompe a execução do script
                }
            } catch (e) {
                console.error("Erro ao verificar status do link:", e);
                // Em caso de erro, continua para não travar a página, mas pode ser um ponto a investigar.
            }
        }
        // --- FIM DA NOVA VERIFICAÇÃO DE LINK EXPIRADO ---

        if (!responsavel || !membrosRaw) {
            // Se não houver parâmetros na URL, redireciona para alguma página de erro ou home
            window.location.href = 'link_invalido.html'; // Crie um link_invalido.html se quiser
            return;
        }

        const membros = membrosRaw.split(',').map(m => m.trim());

        document.getElementById('responsavelNome').textContent = responsavel;
        const listaMembros = document.getElementById('listaMembros');
        membros.forEach(m => {
            const li = document.createElement('li');
            li.textContent = m;
            listaMembros.appendChild(li);
        });

        const sugestaoSalva = localStorage.getItem(SUGESTAO_KEY);
        if (sugestaoSalva) {
            sugestaoPresente = sugestaoSalva;
        }
        document.getElementById('sugestaoPresente').innerHTML = sugestaoPresente;

        const confirmacaoSelect = document.getElementById('confirmacaoSelect');
        const campoAusencia = document.getElementById('campoAusencia');
        const enviarConfirmacaoBtn = document.getElementById('enviarConfirmacao');
        const mensagemAgradecimentoDiv = document.getElementById('mensagemAgradecimento');

        confirmacaoSelect.addEventListener('change', () => {
            if (confirmacaoSelect.value === 'nao') {
                campoAusencia.style.display = 'block';
            } else {
                campoAusencia.style.display = 'none';
            }
        });

        enviarConfirmacaoBtn.addEventListener('click', () => {
            const confirmacao = confirmacaoSelect.value;
            const motivoAusencia = document.getElementById('motivoAusencia').value.trim();
            const dataConfirmacao = new Date().toLocaleString('pt-BR');

            const mensagem = `Confirmação de Presença:\n\n` +
                             `Família do Responsável: ${responsavel}\n` +
                             `Membros: ${membrosRaw}\n` +
                             `Presença: ${confirmacao === 'sim' ? 'SIM' : 'NÃO'}\n` +
                             (confirmacao === 'nao' && motivoAusencia ? `Motivo da Ausência: ${motivoAusencia}\n` : '') +
                             `Data da Confirmação: ${dataConfirmacao}\n\n` +
                             `Link do Convite (para referência): ${window.location.href}`;

            // Simula o envio para a planilha ou outro serviço
            // console.log(mensagem); // Apenas para debug no console

            // Aqui você integraria com o script que salva na planilha, se existir
            // Por enquanto, apenas exibimos a mensagem de agradecimento
            document.querySelector('.card').style.display = 'none';
            mensagemAgradecimentoDiv.style.display = 'block';

            // Opcional: Impedir múltiplas confirmações (salvando o status no localStorage)
            // Você precisaria de um ID único para cada família na URL para isso.
            // Por enquanto, a funcionalidade de "expirar link" já gerencia isso indiretamente.

            alert('Sua confirmação foi registrada com sucesso! Agradecemos muito.');
        });
    });
</script>
</body>
</html>
