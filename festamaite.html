<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Festa da Maitê</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
  :root {
    --rosa: #d63384;
    --rosa-escuro: #ad2a6b;
    --verde: #28a745;
    --cinza-borda: #dcdcdc;
    --bg-grad: linear-gradient(135deg, #ffe0f0, #ffc4e1);
    --card-bg: #fff;
    --radius-card: 18px;
    --radius-btn: 8px;
  }

  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg-grad);
    min-height: 100vh;
    color: #333;
  }

  /* Layout base */
  .center-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 16px;
    text-align: center;
  }

  .card {
    background: var(--card-bg);
    padding: 32px 28px;
    border-radius: var(--radius-card);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    max-width: 90%;
    width: 600px;
  }

  /* Títulos */
  .title-invite {
    color: var(--rosa-escuro);
    margin-bottom: 8px;
    font-size: 2.5rem;
  }
  .title-admin {
    color: var(--rosa-escuro);
    font-size: 2rem;
    margin-bottom: 16px;
  }
  .admin-subtitle {
    font-size: 1rem;
    color: #666;
    margin-bottom: 24px;
  }

  /* Formulário de convite */
  .guest-invite p {
    font-size: 1.1rem;
    color: #555;
    line-height: 1.5;
  }
  .guest-invite strong {
    font-weight: bold;
    color: var(--rosa-escuro);
  }

  /* Botões */
  button {
    background-color: var(--rosa);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: var(--radius-btn);
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.1s;
    margin-top: 16px;
  }
  button:hover {
    background-color: var(--rosa-escuro);
  }
  button:active {
    transform: scale(0.98);
  }
  .add-btn {
    background-color: var(--verde);
  }
  .add-btn:hover {
    background-color: #218838;
  }

  /* Admin Area */
  .admin-area {
    display: none;
    background-color: #f8f9fa;
    padding: 24px;
    border-radius: var(--radius-card);
    margin-top: 24px;
    position: relative;
  }
  .admin-area h3 {
    color: var(--rosa-escuro);
    margin-top: 0;
  }
  .admin-area .closeBtn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: transparent;
    color: #666;
    font-size: 1.5rem;
    padding: 0;
    margin: 0;
  }
  .admin-area .closeBtn:hover {
    color: #333;
    background: transparent;
  }

  .form-group {
    margin-bottom: 16px;
    text-align: left;
  }
  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: #555;
  }
  .form-group input {
    width: calc(100% - 20px);
    padding: 10px;
    border: 1px solid var(--cinza-borda);
    border-radius: var(--radius-btn);
    font-size: 1rem;
  }

  .admin-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 24px;
  }
  .admin-controls .export-btn {
    background-color: #007bff;
  }
  .admin-controls .export-btn:hover {
    background-color: #0069d9;
  }

  /* Tabela */
  .familia-table-container {
    margin-top: 24px;
    overflow-x: auto;
  }
  .familia-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 500px;
  }
  .familia-table th, .familia-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid var(--cinza-borda);
  }
  .familia-table th {
    background-color: #f1f1f1;
    color: #555;
    font-weight: bold;
  }
  .familia-table tr:hover {
    background-color: #f8f9fa;
  }

  .familia-table td .actions {
    display: flex;
    gap: 8px;
  }
  .familia-table td .actions button {
    padding: 8px;
    margin: 0;
  }
  .familia-table td .actions button i {
    font-size: 1rem;
  }
  .familia-table td .actions .encaminharBtn {
    background-color: var(--verde);
  }
  .familia-table td .actions .editBtn {
    background-color: #ffc107;
  }
  .familia-table td .actions .deleteBtn {
    background-color: #dc3545;
  }
  .familia-table td .actions .encaminharBtn:hover {
    background-color: #218838;
  }
  .familia-table td .actions .editBtn:hover {
    background-color: #e0a800;
  }
  .familia-table td .actions .deleteBtn:hover {
    background-color: #c82333;
  }

  /* Modal de Edição */
  .edit-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
    align-items: center;
    justify-content: center;
  }
  .modal-content {
    background-color: #fefefe;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 400px;
    border-radius: var(--radius-btn);
    position: relative;
    text-align: left;
  }
  .edit-modal .edit-close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }
  .edit-modal .edit-close:hover,
  .edit-modal .edit-close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }

  /* Sugestão de Presente */
  .sugestao-container {
    margin-top: 24px;
    text-align: left;
    display: none; /* Inicia oculto */
  }
  .sugestao-container h4 {
    margin-bottom: 8px;
  }
  .sugestao-container textarea {
    width: 100%;
    height: 100px;
    padding: 10px;
    border: 1px solid var(--cinza-borda);
    border-radius: var(--radius-btn);
    box-sizing: border-box;
    font-size: 1rem;
    resize: vertical;
  }
</style>
</head>
<body>

<div id="homePage" class="center-wrap">
  <div class="card guest-invite">
    <h1 class="title-invite">Festa de Aniversário</h1>
    <p>Olá! Você foi convidado(a) para o aniversário da nossa querida Maitê!</p>
    <button id="loginBtn">Área do Administrador</button>
  </div>
</div>

<div id="confirmPage" class="center-wrap" style="display: none;">
  <div class="card guest-invite">
    <h1 class="title-invite">Olá, <span id="nomeConvidado"></span>!</h1>
    <p id="membrosConvidado"></p>
    <p>A festa da Maitê está chegando! Confirme sua presença para que possamos organizar tudo.</p>
    <button id="confirmarBtn">Confirmar Presença</button>
    <button id="voltarBtn">Voltar</button>
  </div>
</div>

<div id="adminArea" class="admin-area">
  <button class="closeBtn"><i class="fas fa-times"></i></button>
  <h2 class="title-admin">Área de Administração</h2>
  <p class="admin-subtitle">Gerencie os convidados, edite e envie convites.</p>

  <div class="card" style="padding: 16px;">
    <h3>Adicionar Família</h3>
    <div class="form-group">
      <label for="inputFamilia">Nome da Família:</label>
      <input type="text" id="inputFamilia" placeholder="Ex: Família Silva">
    </div>
    <div class="form-group">
      <label for="inputMembros">Nomes dos Membros:</label>
      <input type="text" id="inputMembros" placeholder="Ex: João, Maria, Pedro">
    </div>
    <button id="addFamiliaBtn" class="add-btn">Adicionar</button>
  </div>

  <div class="admin-controls">
    <button id="exportBtn" class="export-btn"><i class="fas fa-file-csv"></i> Exportar CSV</button>
  </div>

  <div class="familia-table-container">
    <table class="familia-table">
      <thead>
        <tr>
          <th>Família</th>
          <th>Membros</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="tabelaFamilias">
        </tbody>
    </table>
  </div>

  <div class="sugestao-container" id="sugestaoContainer">
    <h4>Sugestão de Presente</h4>
    <textarea id="sugestaoPresente" placeholder="Digite uma sugestão de presente para o convidado..."></textarea>
  </div>

</div>

<div id="editModal" class="edit-modal">
  <div class="modal-content">
    <span class="edit-close">&times;</span>
    <h3>Editar Família</h3>
    <div class="form-group">
      <label for="editFamiliaInput">Nome da Família:</label>
      <input type="text" id="editFamiliaInput">
    </div>
    <div class="form-group">
      <label for="editMembrosInput">Nomes dos Membros:</label>
      <input type="text" id="editMembrosInput">
    </div>
    <button id="editSaveBtn" class="add-btn">Salvar</button>
  </div>
</div>

<script>
/* CONTROLES DO ADMIN */
const ADMIN_PASSWORD = 'maite';
let familias = [];
let sugestaoPresente = '';

const $ = id => document.getElementById(id);

function saveToStorage() {
  localStorage.setItem('familias', JSON.stringify(familias));
}

function loadFromStorage() {
  const storedFamilias = localStorage.getItem('familias');
  if (storedFamilias) {
    familias = JSON.parse(storedFamilias);
  }
}

function renderFamilias() {
  const tabela = $('tabelaFamilias');
  tabela.innerHTML = '';
  familias.forEach((item, index) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item.familia}</td>
      <td>${item.membros}</td>
      <td>
        <div class="actions">
          <button class="encaminharBtn" data-familia="${encodeURIComponent(item.familia)}" data-membros="${encodeURIComponent(item.membros)}"><i class="fas fa-share-square"></i></button>
          <button class="editBtn" data-index="${index}"><i class="fas fa-edit"></i></button>
          <button class="deleteBtn" data-index="${index}"><i class="fas fa-trash"></i></button>
        </div>
      </td>
    `;
    tabela.appendChild(tr);
  });
}

function abrirEditModal(index) {
  const familia = familias[index];
  $('editFamiliaInput').value = familia.familia;
  $('editMembrosInput').value = familia.membros;
  $('editSaveBtn').dataset.index = index;
  $('editModal').style.display = 'flex';
}

function closeEditModal() {
  $('editModal').style.display = 'none';
}

function saveEditFamilia() {
  const index = $('editSaveBtn').dataset.index;
  familias[index].familia = $('editFamiliaInput').value.trim();
  familias[index].membros = $('editMembrosInput').value.trim();
  saveToStorage();
  renderFamilias(); // Chama a renderização após salvar
  closeEditModal();
}

function excluirFamilia(index) {
  if (confirm('Tem certeza que deseja excluir esta família?')) {
    familias.splice(index, 1);
    saveToStorage();
    renderFamilias(); // Chama a renderização após excluir
  }
}

function adicionarFamilia() {
  const familia = $('inputFamilia').value.trim();
  const membros = $('inputMembros').value.trim();
  if (familia && membros) {
    familias.push({ familia, membros, confirmado: false });
    saveToStorage();
    $('inputFamilia').value = '';
    $('inputMembros').value = '';
    renderFamilias(); // AÇÃO CORRIGIDA: Redesenha a lista para que os botões apareçam
  }
}

function abrirWhatsapp(familia, membros) {
  const mensagem = encodeURIComponent(`Olá, você foi convidado(a) para o aniversário da Maitê! Acesse o link para confirmar sua presença: ${window.location.origin}${window.location.pathname}?familia=${familia}&membros=${membros}`);
  window.open(`https://api.whatsapp.com/send?text=${mensagem}`, '_blank');
}

function getQueryParams() {
  const params = {};
  window.location.search.substring(1).split('&').forEach(item => {
    const [key, value] = item.split('=');
    if (key && value) {
      params[key] = decodeURIComponent(value);
    }
  });
  return params;
}

function showHome() {
  $('homePage').style.display = 'block';
  $('confirmPage').style.display = 'none';
}

function showConfirm(familia, membros) {
  $('homePage').style.display = 'none';
  $('confirmPage').style.display = 'block';
  $('nomeConvidado').innerText = familia;
  $('membrosConvidado').innerText = `Convidados: ${membros}`;
}

function confirmarPresenca(familia, membros) {
  const familiaObj = familias.find(f => f.familia === familia);
  if (familiaObj) {
    familiaObj.confirmado = true;
    saveToStorage();
    alert('Confirmação enviada com sucesso! Aguardamos você!');
  } else {
    alert('Erro: Família não encontrada.');
  }
}

function exportCSV() {
  let csv = 'Família,Membros,Confirmado\n';
  familias.forEach(item => {
    csv += `${item.familia},${item.membros},${item.confirmado ? 'Sim' : 'Não'}\n`;
  });
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.setAttribute('href', url);
  link.setAttribute('download', 'familias.csv');
  link.style.visibility = 'hidden';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function saveSugestaoPresente() {
  sugestaoPresente = $('sugestaoPresente').value;
  localStorage.setItem('sugestaoPresente', sugestaoPresente);
}

function loadSugestaoPresente() {
  sugestaoPresente = localStorage.getItem('sugestaoPresente') || 'Nenhuma sugestão ainda';
  $('sugestaoPresente').value = sugestaoPresente;
}

/* EVENTOS GERAIS */
window.addEventListener('DOMContentLoaded', () => {
  loadFromStorage();
  loadSugestaoPresente();
  renderFamilias();

  const { familia, membros } = getQueryParams();
  if (familia) {
    showConfirm(familia, membros);
  } else {
    showHome();
  }

  // Login
  $('loginBtn').addEventListener('click', () => {
    const senha = prompt('Digite a senha de administrador:');
    if (senha === ADMIN_PASSWORD) {
      $('adminArea').style.display = 'block';
      $('sugestaoContainer').style.display = 'block';
    } else {
      alert('Senha incorreta!');
    }
  });

  // Fechar admin
  document.querySelector('#adminArea .closeBtn').addEventListener('click', () => {
    $('adminArea').style.display = 'none';
  });

  // Botão voltar para tela inicial
  $('voltarBtn').addEventListener('click', () => {
    showHome();
  });

  // Adicionar família
  $('addFamiliaBtn').addEventListener('click', adicionarFamilia);

  // Export CSV
  $('exportBtn').addEventListener('click', exportCSV);

  // Salvar sugestão de presente
  $('sugestaoPresente').addEventListener('input', saveSugestaoPresente);

  // Confirmar presença
  $('confirmarBtn').addEventListener('click', () => {
    const { familia, membros } = getQueryParams();
    if (familia) {
        confirmarPresenca(familia, membros);
    } else {
        alert('Não foi possível confirmar a presença. O link pode estar incorreto.');
    }
  });

  // Edit modal botões
  $('editSaveBtn').addEventListener('click', saveEditFamilia);
  document.querySelector('#editModal .edit-close').addEventListener('click', closeEditModal);
  
  // Ações da tabela
  $('tabelaFamilias').addEventListener('click', (event) => {
    if (event.target.closest('.encaminharBtn')) {
      const btn = event.target.closest('.encaminharBtn');
      const familia = decodeURIComponent(btn.dataset.familia);
      const membros = decodeURIComponent(btn.dataset.membros);
      abrirWhatsapp(familia, membros);
    } else if (event.target.closest('.editBtn')) {
      const index = event.target.closest('.editBtn').dataset.index;
      abrirEditModal(index);
    } else if (event.target.closest('.deleteBtn')) {
      const index = event.target.closest('.deleteBtn').dataset.index;
      excluirFamilia(index);
    }
  });
});
</script>
</body>
</html>
