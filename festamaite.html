<!DOCTYPE html>
<html lang="pt-BR">
<head>
Â  Â  <meta charset="UTF-8" />
Â  Â  <title>Festa da MaitÃª</title>
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --rosa: #d63384;
Â  Â  Â  Â  Â  Â  --rosa-escuro: #ad2a6b;
Â  Â  Â  Â  Â  Â  --verde: #28a745;
Â  Â  Â  Â  Â  Â  --cinza-borda: #dcdcdc;
Â  Â  Â  Â  Â  Â  --bg-grad: linear-gradient(135deg, #ffe0f0, #ffc4e1);
Â  Â  Â  Â  Â  Â  --card-bg: #fff;
Â  Â  Â  Â  Â  Â  --radius-card: 18px;
Â  Â  Â  Â  Â  Â  --radius-btn: 8px;
Â  Â  Â  Â  Â  Â  --poppins: 'Poppins', sans-serif;
Â  Â  Â  Â  }
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  font-family: var(--poppins);
Â  Â  Â  Â  Â  Â  background: var(--bg-grad);
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  .center-wrap {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  padding: 16px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .card {
Â  Â  Â  Â  Â  Â  background: var(--card-bg);
Â  Â  Â  Â  Â  Â  padding: 32px 28px;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-card);
Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 24px rgba(0,0,0,0.1);
Â  Â  Â  Â  Â  Â  max-width: 500px;
Â  Â  Â  Â  Â  Â  margin: 16px;
Â  Â  Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  }
Â  Â  Â  Â  h1, h2, h3 {
Â  Â  Â  Â  Â  Â  margin-top: 0;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }
Â  Â  Â  Â  h1 { color: var(--rosa); font-size: 1.9rem; text-align: center; }
Â  Â  Â  Â  h2 { color: var(--rosa); font-size: 1.4rem; text-align: center; }
Â  Â  Â  Â  h3 { color: var(--rosa); font-size: 1.1rem; margin-bottom: 8px; }
Â  Â  Â  Â  p { line-height: 1.4; margin: 0 0 1em; }
Â  Â  Â  Â  .btn {
Â  Â  Â  Â  Â  Â  background-color: var(--rosa);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 12px 20px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-btn);
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  margin-top: 16px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn:hover { background-color: var(--rosa-escuro); }
Â  Â  Â  Â  .form-group {
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  label {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  input {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 0.75rem;
Â  Â  Â  Â  Â  Â  border: 1px solid var(--cinza-borda);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-btn);
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }
Â  Â  Â  Â  #sugestaoPresente {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  min-height: 120px;
Â  Â  Â  Â  Â  Â  padding: 0.75rem;
Â  Â  Â  Â  Â  Â  border: 1px solid var(--cinza-borda);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-btn);
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  background: #f8f9fa;
Â  Â  Â  Â  Â  Â  line-height: 1.4;
Â  Â  Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  Â  Â  cursor: text;
Â  Â  Â  Â  }
Â  Â  Â  Â  .text-center {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Admin specific styles */
Â  Â  Â  Â  #adminArea {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  inset: 0;
Â  Â  Â  Â  Â  Â  background: #fff8fc;
Â  Â  Â  Â  Â  Â  z-index: 999;
Â  Â  Â  Â  Â  Â  padding: 40px 16px 80px;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  .admin-inner {
Â  Â  Â  Â  Â  Â  max-width: 700px;
Â  Â  Â  Â  Â  Â  margin: 0 auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  .closeBtn {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 10px;
Â  Â  Â  Â  Â  Â  right: 20px;
Â  Â  Â  Â  Â  Â  background: transparent;
Â  Â  Â  Â  Â  Â  font-size: 32px;
Â  Â  Â  Â  Â  Â  line-height: 1;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  color: var(--rosa);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .admin-actions {
Â  Â  Â  Â  Â  Â  margin-top: 16px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  }
Â  Â  Â  Â  .admin-btn {
Â  Â  Â  Â  Â  Â  padding: 8px 14px;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-btn);
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .admin-btn.add { background: var(--rosa); color: #fff; }
Â  Â  Â  Â  .admin-btn.mass { background: var(--verde); color: #fff; }
Â  Â  Â  Â  .admin-btn.mass:hover { filter: brightness(0.9); }
Â  Â  Â  Â  #voltarBtn {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 16px;
Â  Â  Â  Â  Â  Â  left: 16px;
Â  Â  Â  Â  Â  Â  background: rgba(255,255,255,0.7);
Â  Â  Â  Â  Â  Â  color: var(--rosa);
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  border: 2px solid var(--rosa);
Â  Â  Â  Â  Â  Â  border-radius: 30px;
Â  Â  Â  Â  Â  Â  padding: 6px 18px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #voltarBtn:hover {
Â  Â  Â  Â  Â  Â  background: rgba(255,255,255,0.9);
Â  Â  Â  Â  }
Â  Â  Â  Â  #familiasContainer {
Â  Â  Â  Â  Â  Â  margin-top: 24px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .familyBox {
Â  Â  Â  Â  Â  Â  border: 1px dashed var(--cinza-borda);
Â  Â  Â  Â  Â  Â  padding: 16px;
Â  Â  Â  Â  Â  Â  margin-bottom: 12px;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-card);
Â  Â  Â  Â  Â  Â  background: #ffffff;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }
Â  Â  Â  Â  .familyBox strong {
Â  Â  Â  Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  Â  Â  Â  color: var(--rosa-escuro);
Â  Â  Â  Â  }
Â  Â  Â  Â  .familyBox p {
Â  Â  Â  Â  Â  Â  margin: 4px 0;
Â  Â  Â  Â  Â  Â  font-size: 0.95rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  .fam-actions {
Â  Â  Â  Â  Â  Â  margin-top: 8px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  }
Â  Â  Â  Â  .fam-btn {
Â  Â  Â  Â  Â  Â  padding: 6px 12px;
Â  Â  Â  Â  Â  Â  font-size: 13px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-btn);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .fam-send { background: var(--verde); color: #fff; }
Â  Â  Â  Â  .fam-edit { background: #ffc107; color: #000; }
Â  Â  Â  Â  .fam-delete { background: #dc3545; color: #fff; }
Â  Â  Â  Â  .fam-btn:hover { filter: brightness(0.9); }
Â  Â  Â  Â  .data-info {
Â  Â  Â  Â  Â  Â  margin-top: 12px;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  background: rgba(40, 167, 69, 0.1);
Â  Â  Â  Â  Â  Â  border-left: 4px solid #28a745;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  .data-info.vencido {
Â  Â  Â  Â  Â  Â  background: rgba(220, 53, 69, 0.1);
Â  Â  Â  Â  Â  Â  border-left-color: #dc3545;
Â  Â  Â  Â  }
Â  Â  Â  Â  .data-info p {
Â  Â  Â  Â  Â  Â  margin: 4px 0;
Â  Â  Â  Â  Â  Â  color: #495057;
Â  Â  Â  Â  }
Â  Â  Â  Â  .data-info.vencido p {
Â  Â  Â  Â  Â  Â  color: #721c24;
Â  Â  Â  Â  }
Â  Â  Â  Â  #editModal {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  inset: 0;
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.45);
Â  Â  Â  Â  Â  Â  z-index: 1001;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  padding: 16px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .edit-content {
Â  Â  Â  Â  Â  Â  background: #fff;
Â  Â  Â  Â  Â  Â  max-width: 420px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 24px;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-card);
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 16px rgba(0,0,0,0.3);
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }
Â  Â  Â  Â  .edit-close {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 8px;
Â  Â  Â  Â  Â  Â  right: 12px;
Â  Â  Â  Â  Â  Â  background: transparent;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  font-size: 24px;
Â  Â  Â  Â  Â  Â  color: var(--rosa);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .edit-save {
Â  Â  Â  Â  Â  Â  margin-top: 16px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  background: var(--rosa);
Â  Â  Â  Â  Â  Â  color: #fff;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-btn);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .edit-save:hover { background: var(--rosa-escuro); }
Â  Â  Â  Â  .login-card {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .error-message {
Â  Â  Â  Â  Â  Â  color: #dc3545;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  @media (max-width:480px) {
Â  Â  Â  Â  Â  Â  .card { padding: 24px 20px; }
Â  Â  Â  Â  Â  Â  h1 { font-size: 1.6rem; }
Â  Â  Â  Â  Â  Â  .btn { width: 100%; }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

<div id="homeView" class="center-wrap">
Â  Â  <div class="card text-center">
Â  Â  Â  Â  <h1>Festa da MaitÃª ğŸ‰</h1>
Â  Â  Â  Â  <p>Estamos muito felizes em celebrar o 1Âº aninho da nossa princesa MaitÃª! ğŸ’œ</p>
Â  Â  Â  Â  <p>
Â  Â  Â  Â  Â  Â  MamÃ£e ou papai, estamos muito felizes em ajudar vocÃªs com a festa da MaitÃª!<br>
Â  Â  Â  Â  Â  Â  Este espaÃ§o foi personalizado para facilitar o envio dos convites, acompanhar as confirmaÃ§Ãµes de presenÃ§a e tornar esse momento ainda mais especial.
Â  Â  Â  Â  </p>
Â  Â  Â  Â  <button id="adminLoginBtn" class="btn" type="button">Ãrea de Admin</button>
Â  Â  </div>
</div>

<div id="confirmView" class="center-wrap" hidden>
Â  Â  <div class="card" id="confirmCard">
Â  Â  Â  Â  <h1>MaitÃª faz 1 aninho! ğŸ‘§ğŸ‰</h1>
Â  Â  Â  Â  <p id="familiaSaudacao"></p>
Â  Â  Â  Â  <p>
Â  Â  Â  Â  Â  Â  ğŸ—“ï¸ <strong>Data:</strong> 20 de Setembro<br>
Â  Â  Â  Â  Â  Â  ğŸ•’ <strong>HorÃ¡rio:</strong> das 19:30 Ã s 23:30<br>
Â  Â  Â  Â  Â  Â  ğŸ“ <strong>Local:</strong> Avenida SÃ£o Miguel, 8001 - SP
Â  Â  Â  Â  </p>
Â  Â  Â  Â  <div class="text-center">
Â  Â  Â  Â  Â  Â  <button id="confirmarBtn" class="btn" type="button">Confirmar PresenÃ§a</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<div id="loginView" class="center-wrap" hidden>
Â  Â  <div class="card login-card">
Â  Â  Â  Â  <h1>Acesso Administrativo</h1>
Â  Â  Â  Â  <p>Por favor, insira a senha para acessar a Ã¡rea de gerenciamento.</p>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="adminPassword">Senha:</label>
Â  Â  Â  Â  Â  Â  <input type="password" id="adminPassword" placeholder="Digite a senha">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button id="loginSubmitBtn" class="btn" type="button">Entrar</button>
Â  Â  Â  Â  <p id="loginErrorMessage" class="error-message" hidden>Senha incorreta. Tente novamente.</p>
Â  Â  </div>
</div>

<div id="adminArea" hidden>
Â  Â  <button id="voltarBtn" type="button">Voltar</button>
Â  Â  <button class="closeBtn" type="button" aria-label="Fechar Admin">&times;</button>
Â  Â  <div class="admin-inner">
Â  Â  Â  Â  <h2>Cadastro de FamÃ­lias</h2>
Â  Â  Â  Â  <div class="admin-form">
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="responsavel">ResponsÃ¡vel (Ex: Sueli)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="responsavel" placeholder="ResponsÃ¡vel" required />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="membros">Membros (Ex: Sueli, Adilson, Eduardo)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="membros" placeholder="Membros separados por vÃ­rgula" required />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="telefone">Telefone com DDD (somente nÃºmeros)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="telefone" type="tel" placeholder="Ex: 11999999999" required />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="sugestaoPresente">SugestÃ£o de Presente</label>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="sugestaoPresente" contenteditable="true" spellcheck="false" placeholder="Digite a sugestÃ£o de presente..."></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="admin-actions">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="admin-btn add" type="button" id="addFamiliaBtn">Adicionar FamÃ­lia</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="admin-btn mass" type="button" id="enviarTodosBtn">Enviar Todos</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="admin-btn mass" type="button" id="exportBtn" title="Exportar em CSV">Exportar CSV</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="familiasContainer"></div>
Â  Â  </div>
</div>

<div id="editModal">
Â  Â  <div class="edit-content">
Â  Â  Â  Â  <button class="edit-close" type="button" aria-label="Fechar ediÃ§Ã£o">&times;</button>
Â  Â  Â  Â  <h3>Editar FamÃ­lia</h3>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="editResponsavel">ResponsÃ¡vel</label>
Â  Â  Â  Â  Â  Â  <input id="editResponsavel" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="editMembros">Membros</label>
Â  Â  Â  Â  Â  Â  <input id="editMembros" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="editTelefone">Telefone</label>
Â  Â  Â  Â  Â  Â  <input id="editTelefone" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button class="edit-save" type="button" id="editSaveBtn">Salvar AlteraÃ§Ãµes</button>
Â  Â  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
Â  Â  // #region UTILITIES & STATE
Â  Â  const $ = (id) => document.getElementById(id);
Â  Â  const STORAGE_KEY = 'conviteMaite_familias_v1';
Â  Â  const SUGESTAO_KEY = 'conviteMaite_sugestao_v1';
Â  Â  const ADMIN_PASSWORD = 'maite'; // TROQUE ESTA SENHA!

Â  Â  let familias = [];
Â  Â  let sugestaoPresente = `
Â  Â  Â  Â  ğŸ *SugestÃ£o de Presente* ğŸ
Â  Â  Â  Â  <br><br>
Â  Â  Â  Â  ğŸ‘— Roupa tamanho 1
Â  Â  Â  Â  <br>
Â  Â  Â  Â  ğŸ‘Ÿ Sapato nÂº 17/18
Â  Â  Â  Â  <br>
Â  Â  Â  Â  ğŸ§¸ Gosta de brinquedos coloridos
Â  Â  Â  Â  <br><br>
Â  Â  Â  Â  _ (Essas sÃ£o apenas sugestÃµes! Sua presenÃ§a Ã© o melhor presente. ğŸ’–)_
Â  Â  `.trim().replace(/\n/g, '');

Â  Â  function getQueryParams() {
Â  Â  Â  Â  const params = new URLSearchParams(window.location.search);
Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  familia: params.get('familia'),
Â  Â  Â  Â  Â  Â  membros: params.get('membros')
Â  Â  Â  Â  };
Â  Â  }
Â  Â Â 
Â  Â  function buildInviteLink(familiaName, membrosList) {
Â  Â  Â  Â  const baseUrl = window.location.origin + window.location.pathname.replace(/[^/]*$/, '');
Â  Â  Â  Â  return `${baseUrl}index.html?familia=${encodeURIComponent(familiaName)}&membros=${encodeURIComponent(membrosList)}`;
Â  Â  }
Â  Â Â 
Â  Â  function sanitizePhone(raw) {
Â  Â  Â  Â  const digits = raw.replace(/\D+/g, '');
Â  Â  Â  Â  return digits.length >= 10 ? digits : null;
Â  Â  }

Â  Â  function adicionarDiasUteis(data, diasUteis) {
Â  Â  Â  Â  const resultado = new Date(data);
Â  Â  Â  Â  let diasAdicionados = 0;
Â  Â  Â  Â  while (diasAdicionados < diasUteis) {
Â  Â  Â  Â  Â  Â  resultado.setDate(resultado.getDate() + 1);
Â  Â  Â  Â  Â  Â  if (resultado.getDay() !== 0 && resultado.getDay() !== 6) {
Â  Â  Â  Â  Â  Â  Â  Â  diasAdicionados++;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  return resultado;
Â  Â  }
Â  Â Â 
Â  Â  function formatarData(data) {
Â  Â  Â  Â  return data.toLocaleDateString('pt-BR', {
Â  Â  Â  Â  Â  Â  day: '2-digit',
Â  Â  Â  Â  Â  Â  month: '2-digit',
Â  Â  Â  Â  Â  Â  year: 'numeric'
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // #endregion

Â  Â  // #region STORAGE MANAGEMENT
Â  Â  function loadFromStorage() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const raw = localStorage.getItem(STORAGE_KEY);
Â  Â  Â  Â  Â  Â  if (raw) familias = JSON.parse(raw);
Â  Â  Â  Â  Â  Â  const sugestaoRaw = localStorage.getItem(SUGESTAO_KEY);
Â  Â  Â  Â  Â  Â  if (sugestaoRaw) sugestaoPresente = sugestaoRaw;
Â  Â  Â  Â  Â  Â  $('sugestaoPresente').innerHTML = sugestaoPresente;
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error('Erro ao carregar storage', e);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function saveToStorage() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  localStorage.setItem(STORAGE_KEY, JSON.stringify(familias));
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error('Erro ao salvar storage', e);
Â  Â  Â  Â  }
Â  Â  }
Â  Â  function saveSugestaoPresente() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  sugestaoPresente = $('sugestaoPresente').innerHTML;
Â  Â  Â  Â  Â  Â  localStorage.setItem(SUGESTAO_KEY, sugestaoPresente);
Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  console.error('Erro ao salvar sugestÃ£o', e);
Â  Â  Â  Â  }
Â  Â  }
Â  Â  // #endregion

Â  Â  // #region UI RENDERING
Â  Â  function renderFamilias() {
Â  Â  Â  Â  const container = $('familiasContainer');
Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  if (!familias.length) {
Â  Â  Â  Â  Â  Â  container.innerHTML = '<p>Nenhuma famÃ­lia cadastrada ainda.</p>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  familias.forEach(fam => {
Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  div.className = 'familyBox';
Â  Â  Â  Â  Â  Â  const link = buildInviteLink(fam.responsavel, fam.membros);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let dataInfo = '';
Â  Â  Â  Â  Â  Â  if (fam.dataEnvio && fam.dataVencimento) {
Â  Â  Â  Â  Â  Â  Â  Â  const hoje = new Date();
Â  Â  Â  Â  Â  Â  Â  Â  const vencimento = new Date(fam.dataVencimento);
Â  Â  Â  Â  Â  Â  Â  Â  const vencido = hoje > vencimento;
Â  Â  Â  Â  Â  Â  Â  Â  dataInfo = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="data-info ${vencido ? 'vencido' : ''}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>ğŸ“… Enviado em:</strong> ${formatarData(new Date(fam.dataEnvio))}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>â° Vence em:</strong> ${formatarData(vencimento)} ${vencido ? '(VENCIDO)' : ''}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <strong>${fam.responsavel}</strong>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Membros: ${fam.membros}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Tel: ${fam.telefone}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-size:12px;word-break:break-all;">Link: <a href="${link}" target="_blank">${link}</a></p>
Â  Â  Â  Â  Â  Â  Â  Â  ${dataInfo}
Â  Â  Â  Â  Â  Â  Â  Â  <div class="fam-actions">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="fam-btn fam-send" type="button" data-id="${fam.id}">Encaminhar</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="fam-btn fam-edit" type="button" data-id="${fam.id}">Editar</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="fam-btn fam-delete" type="button" data-id="${fam.id}">Excluir</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  container.appendChild(div);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // #endregion

Â  Â  // #region PAGE & MODAL MANAGEMENT
Â  Â  function showView(viewName) {
Â  Â  Â  Â  const views = {
Â  Â  Â  Â  Â  Â  home: $('homeView'),
Â  Â  Â  Â  Â  Â  confirm: $('confirmView'),
Â  Â  Â  Â  Â  Â  login: $('loginView'),
Â  Â  Â  Â  Â  Â  admin: $('adminArea')
Â  Â  Â  Â  };
Â  Â  Â  Â  for (const view in views) {
Â  Â  Â  Â  Â  Â  views[view].hidden = true;
Â  Â  Â  Â  Â  Â  if (views[view].style) views[view].style.display = 'none';
Â  Â  Â  Â  }
Â  Â  Â  Â  if (views[viewName]) {
Â  Â  Â  Â  Â  Â  views[viewName].hidden = false;
Â  Â  Â  Â  Â  Â  if (views[viewName].style) views[viewName].style.display = 'flex';
Â  Â  Â  Â  }
Â  Â  Â  Â  if (viewName === 'admin') {
Â  Â  Â  Â  Â  Â  views[viewName].style.display = 'block';
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  let editId = null;
Â  Â  function openEditModal(id) {
Â  Â  Â  Â  const fam = familias.find(f => f.id === id);
Â  Â  Â  Â  if (!fam) return;
Â  Â  Â  Â  editId = id;
Â  Â  Â  Â  $('editResponsavel').value = fam.responsavel;
Â  Â  Â  Â  $('editMembros').value = fam.membros;
Â  Â  Â  Â  $('editTelefone').value = fam.telefone;
Â  Â  Â  Â  $('editModal').style.display = 'flex';
Â  Â  }

Â  Â  function closeEditModal() {
Â  Â  Â  Â  editId = null;
Â  Â  Â  Â  $('editModal').style.display = 'none';
Â  Â  }
Â  Â  // #endregion

Â  Â  // #region EVENT HANDLERS
Â  Â  function handleLogin() {
Â  Â  Â  Â  const password = $('adminPassword').value;
Â  Â  Â  Â  if (password === ADMIN_PASSWORD) {
Â  Â  Â  Â  Â  Â  showView('admin');
Â  Â  Â  Â  Â  Â  $('loginErrorMessage').hidden = true;
Â  Â  Â  Â  Â  Â  $('adminPassword').value = '';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  $('loginErrorMessage').hidden = false;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function handleAddFamilia() {
Â  Â  Â  Â  const responsavel = $('responsavel').value.trim();
Â  Â  Â  Â  const membros = $('membros').value.trim();
Â  Â  Â  Â  const telefone = sanitizePhone($('telefone').value.trim());

Â  Â  Â  Â  if (!responsavel || !membros || !telefone) {
Â  Â  Â  Â  Â  Â  alert('Preencha todos os campos corretamente (telefone com DDD, sÃ³ nÃºmeros).');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const id = crypto.randomUUID ? crypto.randomUUID() : String(Date.now() + Math.random());
Â  Â  Â  Â  familias.push({ id, responsavel, membros, telefone });
Â  Â  Â  Â  saveToStorage();
Â  Â  Â  Â  renderFamilias();

Â  Â  Â  Â  $('responsavel').value = '';
Â  Â  Â  Â  $('membros').value = '';
Â  Â  Â  Â  $('telefone').value = '';
Â  Â  }

Â  Â  function handleSaveEditFamilia() {
Â  Â  Â  Â  if (!editId) return;
Â  Â  Â  Â  const fam = familias.find(f => f.id === editId);
Â  Â  Â  Â  if (!fam) return;

Â  Â  Â  Â  const responsavel = $('editResponsavel').value.trim();
Â  Â  Â  Â  const membros = $('editMembros').value.trim();
Â  Â  Â  Â  const telefone = sanitizePhone($('editTelefone').value.trim());

Â  Â  Â  Â  if (!responsavel || !membros || !telefone) {
Â  Â  Â  Â  Â  Â  alert('Preencha todos os campos corretamente (telefone com DDD, sÃ³ nÃºmeros).');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  fam.responsavel = responsavel;
Â  Â  Â  Â  fam.membros = membros;
Â  Â  Â  Â  fam.telefone = telefone;

Â  Â  Â  Â  saveToStorage();
Â  Â  Â  Â  renderFamilias();
Â  Â  Â  Â  closeEditModal();
Â  Â  }

Â  Â  function handleDeleteFamilia(id) {
Â  Â  Â  Â  const fam = familias.find(f => f.id === id);
Â  Â  Â  Â  if (!fam) return;
Â  Â  Â  Â  if (!confirm(`Tem certeza que deseja excluir a famÃ­lia de ${fam.responsavel}?`)) return;
Â  Â  Â  Â  familias = familias.filter(f => f.id !== id);
Â  Â  Â  Â  saveToStorage();
Â  Â  Â  Â  renderFamilias();
Â  Â  }

Â  Â  function enviarLinkWhatsApp(fam) {
Â  Â  Â  Â  // ConstruÃ§Ã£o do link de convite
Â  Â  Â  Â  const link = buildInviteLink(fam.responsavel, fam.membros);

Â  Â  Â  Â  // Mensagem do WhatsApp com emojis e formataÃ§Ã£o
Â  Â  Â  Â  const msg = `ğŸŒŸâœ¨ OlÃ¡, meus amiguinhos e familiares encantados! âœ¨ğŸŒŸ%0A%0A` +
Â  Â  Â  Â  Â  `O meu aniversÃ¡rio estÃ¡ se aproximando, e eu estou radiante de alegria! ğŸ¥³ğŸ‚%0A%0A` +
Â  Â  Â  Â  Â  `Quero muito que vocÃª faÃ§a parte dessa festinha dos sonhos, cheia de amor, magia e sorrisos! ğŸŒˆğŸ§šâ€â™€ï¸%0A` +
Â  Â  Â  Â  Â  `A sua presenÃ§a Ã© um presentÃ£o para mim! Mas, se nÃ£o puder vir, nÃ£o tem problemaâ€¦ vamos entender com muito carinho. ğŸ’Œ%0A` +
Â  Â  Â  Â  Â  `Como nossa lista de convidados Ã© bem especial e limitada, Ã© muito importante que cada pessoa confirme a presenÃ§a individualmente. %0A%0A` +
Â  Â  Â  Â  Â  `Assim conseguimos organizar tudo com muito amor e preparar um dia inesquecÃ­vel! ğŸ‰%0A` +
Â  Â  Â  Â  Â  `ğŸ”” Importante:%0A%0A` +
Â  Â  Â  Â  Â  `A confirmaÃ§Ã£o deve ser feita em atÃ© 5 dias Ãºteis apÃ³s o envio deste convite mÃ¡gico.%0A%0A` +
Â  Â  Â  Â  Â  `Se nÃ£o recebermos sua resposta dentro do prazo, vamos entender como uma ausÃªncia â€” e abriremos espaÃ§o para outros convidados encantados. âœ¨%0A` +
Â  Â  Â  Â  Â  `ğŸ“œ Os nomes confirmados serÃ£o entregues aos magos da assessoria do SalÃ£o KidÃ¡hora nesse prazo encantado!%0A` +
Â  Â  Â  Â  Â  `ğŸ’– Para confirmar, basta clicar no link abaixo.%0A` +
Â  Â  Â  Â  Â  `Com todo meu carinho de princesa,%0A` +
Â  Â  Â  Â  Â  `MaitÃª ğŸ’•ğŸ‘‘ğŸˆ%0A%0A` +
Â  Â  Â  Â  Â  `ğŸ‘‡ *Link abaixo para confirmar:*%0A${link}`;

Â  Â  Â  Â  // CriaÃ§Ã£o do link do WhatsApp com a mensagem codificada
Â  Â  Â  Â  const zap = `https://wa.me/55${fam.telefone}?text=${encodeURIComponent(msg)}`;

Â  Â  Â  Â  // Abre o link em uma nova aba
Â  Â  Â  Â  window.open(zap, '_blank');

Â  Â  Â  Â  // LÃ³gica para registrar data de envio e vencimento
Â  Â  Â  Â  const agora = new Date();
Â  Â  Â  Â  const vencimento = adicionarDiasUteis(agora, 5);
Â  Â  Â  Â  fam.dataEnvio = agora.toISOString();
Â  Â  Â  Â  fam.dataVencimento = vencimento.toISOString();
Â  Â  Â  Â  saveToStorage();
Â  Â  Â  Â  renderFamilias();
Â  Â  Â  Â  alert(`Convite enviado! Prazo para resposta: ${formatarData(vencimento)}`);
Â  Â  }
Â  Â Â 
Â  Â  function exportCSV() {
Â  Â  Â  Â  if (!familias.length) {
Â  Â  Â  Â  Â  Â  alert('Nada para exportar.');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const header = ['Responsavel', 'Membros', 'Telefone', 'Link'];
Â  Â  Â  Â  const rows = familias.map(f => {
Â  Â  Â  Â  Â  Â  const link = buildInviteLink(f.responsavel, f.membros);
Â  Â  Â  Â  Â  Â  return [
Â  Â  Â  Â  Â  Â  Â  Â  `"${f.responsavel.replace(/"/g, '""')}"`,
Â  Â  Â  Â  Â  Â  Â  Â  `"${f.membros.replace(/"/g, '""')}"`,
Â  Â  Â  Â  Â  Â  Â  Â  `"${f.telefone}"`,
Â  Â  Â  Â  Â  Â  Â  Â  `"${link}"`
Â  Â  Â  Â  Â  Â  ].join(',');
Â  Â  Â  Â  });
Â  Â  Â  Â  const csv = [header.join(','), ...rows].join('\r\n');
Â  Â  Â  Â  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
Â  Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  Â  a.href = url;
Â  Â  Â  Â  a.download = 'familias_convite_maite.csv';
Â  Â  Â  Â  document.body.appendChild(a);
Â  Â  Â  Â  a.click();
Â  Â  Â  Â  document.body.removeChild(a);
Â  Â  Â  Â  setTimeout(() => URL.revokeObjectURL(url), 1000);
Â  Â  }

Â  Â  // #endregion

Â  Â  // #region INITIALIZATION
Â  Â  loadFromStorage();
Â  Â  renderFamilias();

Â  Â  const { familia, membros } = getQueryParams();
Â  Â  if (familia) {
Â  Â  Â  Â  $('familiaSaudacao').innerHTML = `OlÃ¡, <strong>${familia}</strong>!<br>FamÃ­lia convidada: ${membros || 'â€”'}.`;
Â  Â  Â  Â  showView('confirm');
Â  Â  } else {
Â  Â  Â  Â  showView('home');
Â  Â  }

Â  Â  // Event Listeners
Â  Â  $('adminLoginBtn').addEventListener('click', () => showView('login'));
Â  Â  $('loginSubmitBtn').addEventListener('click', handleLogin);
Â  Â  $('adminPassword').addEventListener('keypress', (e) => {
Â  Â  Â  Â  if (e.key === 'Enter') handleLogin();
Â  Â  });
Â  Â  $('voltarBtn').addEventListener('click', () => showView('home'));
Â  Â  document.querySelector('#adminArea .closeBtn').addEventListener('click', () => showView('home'));
Â  Â  $('addFamiliaBtn').addEventListener('click', handleAddFamilia);
Â  Â  $('exportBtn').addEventListener('click', exportCSV);
Â  Â  $('enviarTodosBtn').addEventListener('click', () => {
Â  Â  Â  Â  alert('Esta funÃ§Ã£o nÃ£o estÃ¡ implementada nesta versÃ£o reestruturada, pois pode ser bloqueada por navegadores. Sugerimos enviar um a um para melhor controle.');
Â  Â  });
Â  Â  $('sugestaoPresente').addEventListener('input', saveSugestaoPresente);
Â  Â  $('confirmarBtn').addEventListener('click', () => {
Â  Â  Â  Â  const { familia, membros } = getQueryParams();
Â  Â  Â  Â  alert(`Obrigado! PresenÃ§a confirmada para: ${familia} (${membros}). Em breve essa confirmaÃ§Ã£o serÃ¡ registrada.`);
Â  Â  });
Â  Â Â 
Â  Â  // Delegated event listener for family actions
Â  Â  $('familiasContainer').addEventListener('click', (e) => {
Â  Â  Â  Â  if (e.target.classList.contains('fam-send')) {
Â  Â  Â  Â  Â  Â  const id = e.target.getAttribute('data-id');
Â  Â  Â  Â  Â  Â  const fam = familias.find(f => f.id === id);
Â  Â  Â  Â  Â  Â  if (fam) enviarLinkWhatsApp(fam);
Â  Â  Â  Â  } else if (e.target.classList.contains('fam-edit')) {
Â  Â  Â  Â  Â  Â  const id = e.target.getAttribute('data-id');
Â  Â  Â  Â  Â  Â  openEditModal(id);
Â  Â  Â  Â  } else if (e.target.classList.contains('fam-delete')) {
Â  Â  Â  Â  Â  Â  const id = e.target.getAttribute('data-id');
Â  Â  Â  Â  Â  Â  handleDeleteFamilia(id);
Â  Â  Â  Â  }
Â  Â  });

Â  Â  $('editSaveBtn').addEventListener('click', handleSaveEditFamilia);
Â  Â  document.querySelector('#editModal .edit-close').addEventListener('click', closeEditModal);
Â  Â  $('editModal').addEventListener('click', (e) => {
Â  Â  Â  Â  if (e.target === $('editModal')) closeEditModal();
Â  Â  });
Â  Â  // #endregion
});
</script>
</body>
</html>
